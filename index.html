<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ch√° do Jo√£o Victor ‚Äì Lista de Presentes</title>
  <link href="https://fonts.googleapis.com/css2?family=Chewy&display=swap" rel="stylesheet">
  <style>
    body { margin: 0; padding: 0; font-family: Arial, sans-serif; background: #b3d0b3; color: #5F805F; }
    header { background: #fff; text-align: center; padding: 10px; }
    .lateral-esquerda, .lateral-direita {
      position: fixed;
      top: 0;
      width: 150px;
      height: 100%;
      background: url('floresta_lateral.jpg') center/cover no-repeat;
      z-index: -1;
    }
    .lateral-esquerda { left: 0; }
    .lateral-direita { right: 0; }
    .animal-strip { font-size: 48px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
    .container { max-width: 900px; margin: auto; padding: 20px; text-align: center; }
    .galeria { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; justify-content: center; }
    .item { width: 220px; height: 320px; border: 1px solid #5F805F; border-radius: 10px; padding: 10px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; background: #fff; }
    .item .emoji { font-size: 48px; }
    button { background: #5F805F; color: #fff; border: none; padding: 10px; border-radius: 5px; cursor: pointer; margin: 5px; }
    @media (max-width: 768px) {
      .galeria { grid-template-columns: repeat(2, 1fr); }
      .item { width: 220px; height: 320px; border: 1px solid #5F805F; border-radius: 10px; padding: 10px; box-sizing: border-box; display: flex; flex-direction: column; justify-content: space-between; background: #fff; }
      .modal-content { width: 95% !important; }
      .animal-strip { font-size: 32px !important; flex-wrap: wrap; }
      #titulo { font-size: 1.8em !important; }
    }
  </style>
</head>
<body>
  <div class="lateral-esquerda"></div>
  <div class="lateral-direita"></div>
  <header>
    <div class="animal-strip">üêµü¶äü¶âü¶íü¶ù ü¶Å üêØüêòüê∏üê¢ü¶ú</div>
    <h1 id="titulo" style="text-transform:uppercase; font-family:'Chewy', cursive; font-size:2.5em;">CH√Å DO JO√ÉO VICTOR</h1>
  </header>
  <div class="container">
    <h2 style="margin-top:20px; text-transform:uppercase;">Lista de Presentes</h2>
    <p>Se preferir contribuir com o nosso ch√°, escolha um presente para o Jo√£o!</p>
    <div id="presentes" class="galeria"></div>
  </div>
<script>
const nomesProdutos = [
  "Cuequinha Antiestresse", "Mamadeira Turbo 3000", "Fralda com Bluetooth", "Roup√£o Jedi Baby",
  "Patinho GPS de Banho", "Body Estampado de Dinossauro", "Babador Wi-Fi", "Naninha Falante",
  "Term√¥metro Musical", "Tapete de Dan√ßa Baby", "Kit Higiene com Glitter", "Travesseiro Antigravidade",
  "Copo Anti-Vazamento Jedi", "Almofada com Mem√≥ria Afetiva", "Livro M√°gico de Banho", "Canguru com Suspens√≥rio Ninja",
  "Cadeirinha com Ejetor de Risadas", "Organizador Intergal√°ctico", "Fralda Recarreg√°vel", "Ber√ßo com Porta USB",
  "Cortador de Unha com Lanterna", "Mochila com Porta Fralda Emergencial", "Term√¥metro Inteligente", "Tapete com Alarme de Soneca",
  "Trocador com Wi-Fi", "Cobertor Antiestresse", "Touca com Isolamento T√©rmico", "Meias de Super-Her√≥i",
  "Toalha que Abra√ßa", "Travesseiro Son√≠fero", "Kit Talheres Gamer", "Len√ßol Autolimpante",
  "Pote T√©rmico com Bluetooth", "Mordedor de Arco-√çris", "Sabonete com Aroma de Ursinho", "Kit Spa Beb√™",
  "Bab√° Eletr√¥nica com IA", "Cadeira Musical de Alimenta√ß√£o", "Troninho com Feedback Sonoro", "Kit Penteado Fashion Baby",
  "Touca para Sonhos Doces", "Almofada que Conta Hist√≥rias", "Colchonete Infl√°vel M√°gico", "Carregador de Beb√™ Humano",
  "Macac√£o com GPS", "Fralda Noturna com Luz de LED", "Toalhas que Fazem C√≥cegas", "Copo de Pr√©-Treinamento infantil"
];

let presentes = [];

fetch("https://script.google.com/macros/s/AKfycbxF7l5PA4A0hjTSmudts708hj6ANfxFiOrNmNdgeuL7-fbei1O08zbSd6wRye5nl-XVDA/exec")
  .then(res => res.json())
  .then(data => {
    presentes = data;
    renderizarPresentes();
  });

function emoji(nome) {
  const mapa = {
    cuequinha: 'ü©≤', mamadeira: 'üçº', fralda: 'üß∑', roup√£o: 'üõÅ', patinho: 'ü¶Ü',
    body: 'üëï', babador: 'üß£', naninha: 'üß∏', term√¥metro: 'üå°Ô∏è', tapete: 'üß∏',
    higiene: 'üßº', travesseiro: 'üõå', copo: 'ü•§', almofada: 'üõãÔ∏è', livro: 'üìñ',
    canguru: 'ü¶ò', cadeirinha: 'ü™ë', organizador: 'üóÉÔ∏è', ber√ßo: 'üõèÔ∏è',
    cortador: '‚úÇÔ∏è', mochila: 'üéí', trocador: 'üîÑ', cobertor: 'üõå',
    touca: 'üß¢', meias: 'üß¶', toalha: 'üßª', talheres: 'üç¥', len√ßol: 'üõèÔ∏è',
    pote: 'ü•£', mordedor: 'ü¶∑', sabonete: 'üßº', spa: 'üíÜ', bab√°: 'üé•',
    cadeira: 'ü™ë', troninho: 'üöΩ', penteado: 'üíá', colchonete: 'üõèÔ∏è',
    carregador: 'üéí', macac√£o: 'üß•', led: 'üí°', felicidade: 'üòä'
  };
  const chave = Object.keys(mapa).find(k => nome.toLowerCase().includes(k));
  return mapa[chave] || 'üéÅ';
}
function renderizarPresentes() {
  const galeria = document.getElementById('presentes');
  galeria.innerHTML = '';
  presentes.forEach((p, i) => {
    const nomeFinal = nomesProdutos[p.id] || p.nome;
    const esgotado = p.cotas <= 0;
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `
      <div class="emoji">${emoji(nomeFinal)}</div>
      <h3 style="color:${esgotado ? 'gray' : 'inherit'}">${nomeFinal}</h3>
      <p style="color:${esgotado ? 'gray' : 'black'}; font-weight:bold">Valor: R$ ${p.valor}</p>
      ${!esgotado ? `<p>Cotas dispon√≠veis: ${p.cotas}</p>` : ''}
      <button onclick="presentear(${i})" style="background:${esgotado ? 'gray' : '#5F805F'}; cursor:${esgotado ? 'not-allowed' : 'pointer'}">${esgotado ? 'ESGOTADO' : 'PRESENTEAR'}</button>
    `;
    galeria.appendChild(div);
  });
}
function presentear(index) {
  const p = presentes[index];
  if (!p || p.cotas <= 0) return;
  const nomeFinal = nomesProdutos[p.id] || p.nome;
  const modal = document.createElement('div');
  modal.className = 'modal show';
  modal.style = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center; z-index:1000;';
  modal.innerHTML = `
    <div class='modal-content' style='background:#fff; padding:30px; border-radius:10px; max-width:500px; width:90%; text-align:center; position:relative;'>
      <button onclick='fecharModal()' style='position:absolute;top:10px;right:10px;'>‚ùå</button>
      <div style='font-size:64px;'>${emoji(nomeFinal)}</div>
      <h2>${nomeFinal}</h2>
      <p style='font-size:1.2em;color:black;font-weight:bold'>Valor: R$ ${p.valor}</p>
      <p style='font-size:1.1em;color:black'>Chave Pix: <strong>065.755.339-57</strong> <button onclick='copiarPix(this)'>Copiar</button></p>
      <p style='margin-top:10px;color:#4CAF50;font-weight:bold'>Papai, mam√£e e Jo√£o agradecem de cora√ß√£o pelo presente! ‚ù§Ô∏è</p>
      <hr style='margin:20px 0'>
      <h2>Mensagem para o Jo√£o</h2>
      <label>Seu nome:</label><br>
      <input type='text' id='nomeMsg' maxlength='50' style='width:90%;margin:5px'><br>
      <label>Deixe sua mensagem:</label><br>
      <textarea id='textoMsg' maxlength='500' oninput='atualizarContador()' style='width:90%;height:100px;margin:5px'></textarea><br>
      <div id='contadorMsg'>500 caracteres restantes</div>
      <button onclick='enviarMensagem()'>Enviar Mensagem</button>
    </div>`;
  document.body.appendChild(modal);
  produtoAtual = p;
  atualizarContador();
  produtoAtual = p;
  atualizarContador();
  document.body.appendChild(modal);
}

function fecharModal() {
  document.querySelectorAll('.modal').forEach(m => m.remove());
}

function copiarPix(btn) {
  navigator.clipboard.writeText('06575533957');
  btn.textContent = 'Copiado!';
  setTimeout(() => btn.textContent = 'Copiar', 2000);
}

function atualizarContador() {
  const txt = document.getElementById('textoMsg');
  const contador = document.getElementById('contadorMsg');
  const restante = 500 - (txt?.value?.length || 0);
  contador.textContent = `${restante} caracteres restantes`;
}

let produtoAtual = null;

function enviarMensagem() {
  const nome = document.getElementById('nomeMsg').value.trim();
  const texto = document.getElementById('textoMsg').value.trim();
  if (!nome || !texto || !produtoAtual) {
    alert('Preencha nome, mensagem e selecione um produto.');
    return;
  }

  // Diminui a cota localmente
  if (produtoAtual.cotas > 0) {
    produtoAtual.cotas--;
    renderizarPresentes();
  }

  // Envia mensagem para planilha
  fetch("https://script.google.com/macros/s/AKfycbxF7l5PA4A0hjTSmudts708hj6ANfxFiOrNmNdgeuL7-fbei1O08zbSd6wRye5nl-XVDA/exec?tipo=mensagem", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      nome,
      texto,
      produto: produtoAtual.nome,
      valor: produtoAtual.valor,
      data: new Date().toLocaleString("pt-BR")
    })
  });

  // Atualiza cotas na planilha
  fetch("https://script.google.com/macros/s/AKfycbx81b8sTSaMut8ho6Xj_zt8iK8pkBUEg83EGNI-Aj_q69bTFPQydxy4Iz-kQ4jCD-V3oA/exec?tipo=presente", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id: produtoAtual.ID ?? produtoAtual.id, nome: produtoAtual.nome, cotas: produtoAtual.cotas })
  });

  alert('Mensagem enviada com sucesso!');
  fecharModal();
}
</script>
</body>
</html>
